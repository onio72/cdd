<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Plano Inclinado - Física y Química</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 20px;
      font-size: 24px;
    }
    h2 {
      margin-top: -10px;
      font-size: 18px;
      color: #555;
    }
    #boton-container {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Física y Química 1º de Bachillerato</h1>
  <h2>Plano inclinado</h2>
  <div id="boton-container"></div>

  <script>
    let angulo;
    let anguloAnterior = null;
    let AB = 300;
    let A, B, C;
    let bloque = null;

    function setup() {
      createCanvas(600, 500).parent(document.body);
      angleMode(DEGREES);
      textAlign(CENTER, CENTER);

      let boton = createButton("Otro ejemplo");
      boton.parent("boton-container");
      boton.mousePressed(generarNuevoTriangulo);

      generarNuevoTriangulo();
    }

    function draw() {
      background(255);
      stroke(0);
      fill(230);

      // Triángulo
      triangle(A.x, A.y, B.x, B.y, C.x, C.y);

      // Vértices
      dibujarVertices();

      // Bloque sobre AC
      drawBloqueSobrePlano();

      // Ángulo
      noStroke();
      fill(0);
      textSize(16);
      text("Ángulo en A: " + angulo + "°", width / 2, 70);

      // Arco del ángulo
      dibujarArcoEnA();
    }

    function generarNuevoTriangulo() {
      // Ángulo nuevo (distinto del anterior)
      let posibles = [];
      for (let a = 5; a <= 85; a += 5) {
        if (a !== anguloAnterior) posibles.push(a);
      }
      angulo = random(posibles);
      anguloAnterior = angulo;

      // Construcción del triángulo
      let centroX = width / 2;
      A = createVector(centroX - AB / 2, height / 2);
      B = createVector(A.x + AB, A.y);
      let altura = tan(angulo) * AB;
      C = createVector(B.x, B.y - altura);

      // Corrección si C sale fuera
      let margenSuperior = 100;
      let margenInferior = 50;
      if (C.y < margenSuperior) {
        let d = margenSuperior - C.y;
        A.y += d;
        B.y += d;
        C.y += d;
      }
      if (C.y > height - margenInferior) {
        let d = C.y - (height - margenInferior);
        A.y -= d;
        B.y -= d;
        C.y -= d;
      }
    }

    function drawBloqueSobrePlano() {
      let dx = C.x - A.x;
      let dy = C.y - A.y;
      let theta = atan2(dy, dx);
      let largo = 60;
      let alto = 40;

      let mx = (A.x + C.x) / 2;
      let my = (A.y + C.y) / 2;

      let lenAC = dist(A.x, A.y, C.x, C.y);
      let ux = dx / lenAC;
      let uy = dy / lenAC;
      let px = -uy;
      let py = ux;

      let Dx = mx - (largo / 2) * ux;
      let Dy = my - (largo / 2) * uy;
      let Ex = mx + (largo / 2) * ux;
      let Ey = my + (largo / 2) * uy;
      let Fx = Ex + alto * px;
      let Fy = Ey + alto * py;
      let Gx = Dx + alto * px;
      let Gy = Dy + alto * py;

      fill(200, 0, 0);
      stroke(0);
      beginShape();
      vertex(Dx, Dy);
      vertex(Ex, Ey);
      vertex(Fx, Fy);
      vertex(Gx, Gy);
      endShape(CLOSE);

      bloque = {
        D: createVector(Dx, Dy),
        E: createVector(Ex, Ey),
        F: createVector(Fx, Fy),
        G: createVector(Gx, Gy)
      };
    }

    function dibujarVertices() {
      fill(0);
      textSize(14);
      noStroke();
      text("A", A.x - 12, A.y - 8);
      text("B", B.x + 12, B.y - 8);
      text("C", C.x - 10, C.y - 10);

      if (bloque) {
        text("D", bloque.D.x - 8, bloque.D.y - 5);
        text("E", bloque.E.x + 8, bloque.E.y - 5);
        text("F", bloque.F.x + 8, bloque.F.y - 5);
        text("G", bloque.G.x - 8, bloque.G.y - 5);
      }
    }

    function dibujarArcoEnA() {
      push();
      noFill();
      stroke(0);
      strokeWeight(1);
      translate(A.x, A.y);
      arc(0, 0, 50, 50, 0, angulo);
      pop();
    }
  </script>
</body>
</html>
