<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Plano Inclinado - Física y Química</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 20px;
      font-size: 24px;
    }
    h2 {
      margin-top: -10px;
      font-size: 18px;
      color: #555;
    }
    #controles {
      margin-top: 20px;
    }
    .slider-label {
      display: block;
      margin: 10px 0 5px 0;
      font-weight: bold;
    }
    input[type=range] {
      width: 300px;
    }
  </style>
</head>
<body>
  <h1>Física y Química 1º de Bachillerato</h1>
  <h2>Plano inclinado</h2>
  <div id="controles"></div>

  <script>
    let angulo = 30;
    let AB = 300;
    let A, B, C;
    let bloque = null;
    let sliderAngulo, sliderMasa;
    let masa = 5;

    function setup() {
      createCanvas(600, 550).parent(document.body);
      angleMode(DEGREES);
      textAlign(CENTER, CENTER);

      const controles = select('#controles');

      createSpan('Ángulo en A (°)').addClass('slider-label').parent(controles);
      sliderAngulo = createSlider(0, 60, angulo, 5);
      sliderAngulo.parent(controles);

      createSpan('Masa del bloque (kg)').addClass('slider-label').parent(controles);
      sliderMasa = createSlider(1, 10, masa, 1);
      sliderMasa.parent(controles);

      generarTriangulo();
    }

    function draw() {
      background(255);
      stroke(0);
      fill(230);

      angulo = sliderAngulo.value();
      masa = sliderMasa.value();

      actualizarTriangulo();

      triangle(A.x, A.y, B.x, B.y, C.x, C.y);

      dibujarVertices();
      drawBloqueSobrePlano();

      noStroke();
      fill(0);
      textSize(16);
      text("Ángulo en A: " + angulo + "°", width / 2, 70);
      text("Masa del bloque: " + masa + " kg", width / 2, 95);

      dibujarArcoEnA();
    }

    function generarTriangulo() {
      let centroX = width / 2;
      A = createVector(centroX - AB / 2, height / 2);
      B = createVector(A.x + AB, A.y);
      actualizarTriangulo();
    }

    function actualizarTriangulo() {
      let altura = tan(angulo) * AB;
      C = createVector(B.x, B.y - altura);

      let margenSuperior = 100;
      let margenInferior = 100;

      if (C.y < margenSuperior) {
        let d = margenSuperior - C.y;
        A.y += d;
        B.y += d;
        C.y += d;
      }
      if (C.y > height - margenInferior) {
        let d = C.y - (height - margenInferior);
        A.y -= d;
        B.y -= d;
        C.y -= d;
      }
    }

    function drawBloqueSobrePlano() {
      let dx = C.x - A.x;
      let dy = C.y - A.y;
      let lenAC = dist(A.x, A.y, C.x, C.y);

      let minL = 0.10 * AB;
      let maxL = 0.20 * AB;
      let largo = map(masa, 1, 10, minL, maxL);
      let alto = largo; // DE = DG

      let ux = dx / lenAC;
      let uy = dy / lenAC;
      let px = -uy;
      let py = ux;

      let mx = (A.x + C.x) / 2;
      let my = (A.y + C.y) / 2;

      let Dx = mx - (largo / 2) * ux;
      let Dy = my - (largo / 2) * uy;
      let Ex = mx + (largo / 2) * ux;
      let Ey = my + (largo / 2) * uy;
      let Fx = Ex + alto * px;
      let Fy = Ey + alto * py;
      let Gx = Dx + alto * px;
      let Gy = Dy + alto * py;

      fill(200, 0, 0);
      stroke(0);
      beginShape();
      vertex(Dx, Dy); // D
      vertex(Gx, Gy); // G
      vertex(Fx, Fy); // F
      vertex(Ex, Ey); // E
      endShape(CLOSE);

      bloque = {
        D: createVector(Dx, Dy),
        E: createVector(Ex, Ey),
        F: createVector(Fx, Fy),
        G: createVector(Gx, Gy)
      };
    }

    function dibujarVertices() {
      fill(0);
      textSize(14);
      noStroke();
      text("A", A.x - 12, A.y - 8);
      text("B", B.x + 12, B.y - 8);
      text("C", C.x - 10, C.y - 10);

      if (bloque) {
        text("D", bloque.D.x - 8, bloque.D.y - 5);
        text("E", bloque.E.x + 8, bloque.E.y - 5);
        text("F", bloque.F.x + 8, bloque.F.y - 5);
        text("G", bloque.G.x - 8, bloque.G.y - 5);
      }
    }

    function dibujarArcoEnA() {
      push();
      noFill();
      stroke(0);
      strokeWeight(1);
      translate(A.x, A.y);
      arc(0, 0, 50, 50, 0, angulo);
      pop();
    }
  </script>
</body>
</html>
